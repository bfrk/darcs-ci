Just "\nContext:\n\n\n[document and cleanup Darcs.Util.File\nBen Franksen <ben.franksen@online.de>**20220521104856\n Ignore-this: 7f56e7ba180d1f34b063e52aaadd58857087e580017d6b443791c2beac2ec41aba751ca5d99b466a\n] \n\n[move osxCacheDir and xdgCacheDir to D.R.Prefs\nBen Franksen <ben.franksen@online.de>**20220521101952\n Ignore-this: e06aecfea9997c8371f5712efbb6f7c9d573761472ce00c98e0de4b930f545b99cdd80a351a9af0c\n] \n\n[add (only one) warning when hard-linking cache files fails for bad reasons\nBen Franksen <ben.franksen@online.de>**20220525111230\n Ignore-this: acec4d9da3bcb091550a2d9c8dc1f705b892321887b9fcf9bc10d2044cb7189a00ba85e5a6058893\n] \n\n[fix: hard-linking should be entirely optional\nBen Franksen <ben.franksen@online.de>**20220525083649\n Ignore-this: 8ed2e2149086103dbd010998e946a5443341f0898b795c002b4ace5789d71f7fce7d4a4c9fee0b88\n \n This fixes a bug introduced in\n \n patch 018c5978374ec2cb3ae4f918d733da948bda73da\n Author: Ben Franksen <ben.franksen@online.de>\n Date:   Mon Nov  9 15:47:50 CET 2020\n   * improve cache utilization\n \n where I made the mistake of catching only \"does not exist\" errors when\n trying to hard-link files between repo and cache. This is wrong since there\n could be many reasons why this legitimately fails, including situations\n where the repo and cache happen to be on different file systems.\n \n Ideally we would want to warn the user about this, but it is difficult to\n ensure that the warning is issued only once per run w/o resorting to hacks\n like mutable variables.\n] \n\n[hlint Darcs.Util.Cache\nBen Franksen <ben.franksen@online.de>**20220521192202\n Ignore-this: 210c5a7dae41c459a9880a5e3e58883da866e0a39ec9cf0a958c9da460580462e9131420ab24e412\n] \n\n[move all of Darcs.Util.External to Darcs.Util.File\nBen Franksen <ben.franksen@online.de>**20220521095228\n Ignore-this: d7362ce863ada7367a0a8a67e8b29263f4d88de75187a2bae89a47a8db842bfd628952dbff8f850e\n \n To break an import cycle this also moves withTemp and withOpenTemp\n from darcs.Util.Lock to Darcs.Util.File.\n] \n\n[WIP harness: more cleanups for shell tests\nBen Franksen <ben.franksen@online.de>**20220522105130\n Ignore-this: ec71c1fc2203f75046869729ee606a49d142dcda26d710c7aea54cb85544779789534b50e8261aac\n] \n\n[enable running all symlink tests on Windows\nBen Franksen <ben.franksen@online.de>**20220513072218\n Ignore-this: 746991310507bf4ccf6fa1d252149c45af682e6cb9c512a54f2551bbb020b91acd42cbb9f5d6de4e\n \n The only exception is when we use mkfifo in\n tests/issue1645-ignore-symlinks.sh which is very much specific to Posix.\n] \n\n[fix and reactivate test for issue1599\nBen Franksen <ben.franksen@online.de>**20220522114117\n Ignore-this: 8645d57a6e0a3f3943fa0477264b53b7f63e04c70816d055547c04d08b9a6ca72e2231bcd12ba1e2\n \n The test had a missing 'darcs tag' command to set up the repo, since w/o a\n tag the clone is not really lazy. Then it tested the wrong thing by relying\n on debug output which no longer gets issued. The underlying issue has indeed\n been resolved by the patch that claims so.\n] \n\n[restore functionality of DARCS_CONNECTION_TIMEOUT env var\nBen Franksen <ben.franksen@online.de>**20220522105447\n Ignore-this: b2b4bfa2f485f22fc6d6c6f238a1f28af512b691ce408cd73aae90bb1ff94b0c1730688f8054d6ed\n \n This was lost when we threw out downloading via curl. It is actually a\n response timeout now but I kept the name for compatibility.\n] \n\n[require unix-compat >= 0.6 for improved symlink support\nBen Franksen <ben.franksen@online.de>**20220522162140\n Ignore-this: cdbc5626bc3492de57e7fcd20edfa9ff867304ee55f8ec2e4251a28df19f446851ccd8268cc240f1\n] \n\n[remove obsolete src/hscurl.*\nBen Franksen <ben.franksen@online.de>**20220522105315\n Ignore-this: 44d5de00ad7ef34e0b9fdbeca052290b7e731c9836b171ca861beb6568c9bab6571de5a944c1f049\n] \n\n[harness: split off Darcs.Test.Shell and clean up what remains\nBen Franksen <ben.franksen@online.de>**20220522074138\n Ignore-this: acdd0e4060172f7719c4b4ad78793f93c59ddd56b2ab10b555a92b54e5c460d468e8e5d2b1b334b3\n] \n\n[hlint Darcs.Util.Lock\nBen Franksen <ben.franksen@online.de>**20220521192223\n Ignore-this: 7f7981bc933b26245acdd6a64f8546f67a7901c2e36517f1474c3838d81606f619063871e8cf05b3\n] \n\n[rename cloneXxx to copyXxx, remove cloneFile\nBen Franksen <ben.franksen@online.de>**20220521084938\n Ignore-this: 64e3f5e8b0f4357620a722ce96c247f8460458b67f172f6f8548ec93fd8446a5d26d45de5da5e00\n] \n\n[darcs.cabal: remove duplicate build-depends entry\nBen Franksen <ben.franksen@online.de>**20220521084359\n Ignore-this: dae9a4871ca6d2738f0fbabf0e2170e7c6b879b68335695829184fe816bf7d93a84ed86a0be5556c\n] \n\n[derive instance Show PatchInfo\nBen Franksen <ben.franksen@online.de>**20220514174741\n Ignore-this: 5c2d644dbc4d88292782a550b04593be6e26a2c350d4545341a157deeee7ecdd7c2e4149d6928418\n \n The manually written instance turned out to be useless for debugging the\n property test failure caused by an error in arbitraryUTF8PatchInfo. Also\n note that we already export the data constructor for testing.\n] \n\n[harness: fix arbitraryUTF8PatchInfo\nBen Franksen <ben.franksen@online.de>**20220514174622\n Ignore-this: c24b28fec73dc58c20d7eedeb8ac7baf880f4fb7464b1dc4bd14b88f0b33e4b20f7c6ec0588e84c4\n \n Otherwise propMetadataEncoding may (and does) fail.\n] \n\n[tests/lib: make 'not' fail if command returns 4\nBen Franksen <ben.franksen@online.de>**20220513203406\n Ignore-this: 992795ab972e845f25f9c68cee09fab9b25eddb8ed83a3dbe29c86b79514febb27e61a2161028c7c\n \n This exit code is returned by darcs when the top-level handler receives an\n ErrorCall exception. This signifies a bug in darcs, so should be treated as\n failure of the test even if the script uses 'not' to indicate that darcs is\n expected to fail.\n] \n\n[remove obsolete Darcs.Util.Path.internalMakeName\nBen Franksen <ben.franksen@online.de>**20220513104902\n Ignore-this: c83f6fa3958b04c5e056ee977df5952df55904f2de98bffcdfeeef1fc8b009bb72a2facff7f2d3f3\n] \n\n[Darcs.Util.Path.pathToPosix: avoid mapping id on Posix\nBen Franksen <ben.franksen@online.de>**20220513104747\n Ignore-this: d9c581ba9151e39d247bb7ece6087f335da5bbacbf7329d975b6437e311548e0bbaa3719e6cb82d2\n] \n\n[Darcs.Util.Path: add missing HasCallStack constraints\nBen Franksen <ben.franksen@online.de>**20220513104710\n Ignore-this: 36627607b107803bc964fdf8cb54fd1424a79782664cfac162a0a8798997ea3f1fcb81f543008c48\n] \n\n[make errors in Darcs.Util.Path.decodeWhite explicit\nBen Franksen <ben.franksen@online.de>**20220513104155\n Ignore-this: 39d8caf9dec4d1db07ce4f75377eb372f868314125f53c83bf8494967d27c857f46fdb997671affd\n \n This means we no longer trust that path names in patches have valid\n white-space encoding. Instead this is now a proper parse error.\n] \n\n[remove unused Darcs.Utile.Path.breakOnDir\nBen Franksen <ben.franksen@online.de>**20220513101558\n Ignore-this: 9c126068812a15f8a2137f18c8d529e727afabcca614e26e7615abf11a1599ae460b5c22a791a427\n] \n\n[fix validation of paths from command line\nBen Franksen <ben.franksen@online.de>**20220513083454\n Ignore-this: 8dce4538140ad2fab8e02062ae378a1cee532444edecf84eec44b94487451b247e794bbd9724acc8\n \n The new procedure makeRelativeTo no longer reduces all occurrences of \"..\"\n if they occur in a non-existing trailing part of the input path. This means\n we could run into error calls when calling floatSubPath on SubPaths\n resulting from that. So we need to propagate these errors and catch them at\n the call sites.\n] \n\n[tests/lib: disable use of hspwd.hs\nBen Franksen <ben.franksen@online.de>**20220513071917\n Ignore-this: e25d393bee984930b5fdbb2006c24549373664c9f755fe2a40f6595089be1ece5679d3f704f20f32\n \n With the recent changes in file path handling this is no longer needed.\n However, I verified that the tests still succeed on Windows when it is\n enabled.\n] \n\n[harness: set environment so we can test symlinks on Windows\nBen Franksen <ben.franksen@online.de>**20220513071746\n Ignore-this: 35ad96c8c20c3904124a04a874a6987073a1b4a8d1df3b005903d1262db1825b4dc5c525da9d7b1e\n \n See the URL in the comment for why this is needed.\n] \n\n[tests: some trivial cleanups\nBen Franksen <ben.franksen@online.de>**20220513071541\n Ignore-this: 98af812d10e8f72abd8f93bbb880865b24b42dbf2f168f7dd9ae3153a2b45af09770829849082517\n] \n\n[ci: use haskell/actions/setup@v2\nBen Franksen <ben.franksen@online.de>**20220513053948\n Ignore-this: 2689b247a9d69c42dcf3b465f2d2caf2514a9f4957e9ed501a5ff7c3d2c098dd6b3a95f9d25aa0b6\n] \n\n[ci: run tests with i=yn and --hide\nBen Franksen <ben.franksen@online.de>**20220513053928\n Ignore-this: 49c0a33e1d5aded4974866df9be66100a94093fd0eaac0c19ac9f607b7f20698422824efc36d175f\n] \n\n[fix all symlink problems, including Windows\nBen Franksen <ben.franksen@online.de>**20220512101051\n Ignore-this: ae14ad51dca5f1bab84dbdfc36e1188605491abe2fb00af42350241a8af33d856d2e096cbb384ff3\n] \n\n[extend, generalize, and rename tests/issue1057.sh\nBen Franksen <ben.franksen@online.de>**20220509235618\n Ignore-this: 890cacc6bc914abea294577aa6e95ae44ea332d2294e4002ba0d794c5d157186f5e594da772a5903\n] \n\n[extend and generalize test for issue1078\nBen Franksen <ben.franksen@online.de>**20220505131910\n Ignore-this: 7a7b92fcb395e761a39533814bd5e029cdfc1053e799209ca92aebca4c6e04fc02f5bc8b6cbbac0c\n] \n\n[add two clarifying comments\nBen Franksen <ben.franksen@online.de>**20220509235442\n Ignore-this: 498c1be6329e3afb3375c18d98d5fd826359158c08b1dfd908d1e1f30892512caf3d8991b38b277d\n] \n\n[remove obsolete use of Windows #ifdefs in Darcs.Util.File\nBen Franksen <ben.franksen@online.de>**20220509170048\n Ignore-this: b1225f38ec25c2ebe5f35a3d44198c93dbde99e2b72d70265fcb4d9938e739801ae23536808142aa\n] \n\n[Darcs.Util.ByteString: use the portable System.Directory.getFileSize\nBen Franksen <ben.franksen@online.de>**20220507162917\n Ignore-this: 5941d4646fd9ca57e59b7547d312325f392db7c4ea1047718a393e3e585a6d98aeb8e7207b6363f9\n \n Used to get file size in the error handlers for readSegment and mmapFilePS.\n I guess this is also a bug fix, since in case the file is a symbolic link we\n really want the size of the link target here, not that of the link itself.\n] \n\n[simplify tests/issue2275_follows-symlinks.sh\nBen Franksen <ben.franksen@online.de>**20220507073919\n Ignore-this: 5a6f6bb414afcbbcb1e41722a8c71fd94d00373a2ee5642823230b948a1a02533beeea137c9e0fb6\n \n The test harness nowadays can be run with index enabled and/or disabled so\n we don't need to provide for that in the test script itself.\n] \n\n[harness: make compilation of hspwd more robust\nBen Franksen <ben.franksen@online.de>**20220505182645\n Ignore-this: ed030264472a5d2d1cac638ac9aaad04ed64e6a055f793398cc386cb0a0eb6787119dbc4e5f1293f\n \n This fixes I occasional CI test failures that say\n \n ghc --make -o hspwd /home/runner/work/darcs-ci/darcs-ci/tests/bin/hspwd.hs\n /home/runner/work/darcs-ci/darcs-ci/tests/bin/hspwd.o.tmp:\n renameFile:renamePath:rename: does not exist (No such file or directory)\n ./hspwd\n lib: line 32: ./hspwd: No such file or directory\n] \n\n[enable tests/utf8-display on Windows\nBen Franksen <ben.franksen@online.de>**20220505182502\n Ignore-this: 532754ce83e354d8989518d23b9766c07c14cfa3b7a7deb820a02db1232cfe54970e343971973847\n \n The test succeeds on Windows in the CI.\n] \n\n[rollback of \"work-around to allow build with ghc >= 9.0 on Windows\"\nBen Franksen <ben.franksen@online.de>**20220505182316\n Ignore-this: aaf76aaf4a4fc8df8a6fdf9380eb2d25bff76626905d8ff2ec57b5aedf1804935ffe5970a1df765b\n \n The cabal problem was fixed upstream (in ansi-terminal-0.11.2).\n] \n\n[rollback 856baf0c aka \"Fix darcs-test on Win32 + GHC 6.12+.\"\nBen Franksen <ben.franksen@online.de>**20220501124047\n Ignore-this: 8cc3659e7fa28dbe294ba7247ea827ce56efddfda94353789abdecbc76a67b4c70a7c5c40d5cec0f\n \n This is no longer needed and improves display of paths if they contain\n non-ASCII characters.\n] \n\n[tests/latin9-input.sh: remove obsolete code\nBen Franksen <ben.franksen@online.de>**20220501131342\n Ignore-this: 8674f9fe2a703781e032f040ac1b893661f31ec1fb402637d48ed28604f5e14fa13bae04045cd5d\n] \n\n[tests/lib: fix definition of 'which'\nBen Franksen <ben.franksen@online.de>**20220501131022\n Ignore-this: f666f22e31235ccce3751998838c83380959520e7937b8088da98d719c2d7d973da201b92353547c\n \n In bash, 'type -P x' returns the full path where executable 'x' was found\n and nothing else.\n] \n\n[harness: fix output of darcs executable under test\nBen Franksen <ben.franksen@online.de>**20220501130633\n Ignore-this: b37fa071f7b9597cf5199f223dd5ecb34a1dc2bef9a28cd3c57ea69f359f6a5b3e77cbaa6af0c865\n \n Since it says \"Using darcs executable in\" I expect to see the directory in\n which the darcs executable was found.\n] \n\n[harness: fix quoting env stuff for shell evaluation\nBen Franksen <ben.franksen@online.de>**20220501124245\n Ignore-this: f317da9fa9e9d46ff7656161bb2e6159a14a0fc92542e8ec1a3cc854bc0a66f6c67c3c6abf1ae8b6\n \n Using 'show' here is just wrong (it fails with spaces or non-ASCII\n characters).\n] \n\n[remove Darcs.Util.Compat.canonFilename\nBen Franksen <ben.franksen@online.de>**20220430082509\n Ignore-this: ddc62418584efba013ef23626128578d7c8b75cd2a798d4560c6df8953c818972645689446e056e8\n \n It's (few) uses were replaced with either makeAbsolute or canonicalizePath\n from System.Directory.\n] \n\n[Darcs.Util.Index: fix outdated haddocks\nBen Franksen <ben.franksen@online.de>**20220430092938\n Ignore-this: 5d47c0385dd977a28118f9a38e80ad6c589d7dfd9e2c1b9d0dcbd1e66c3f85a4f4b73ce39f00300f\n] \n\n[.stylish-haskell.yaml: don't break single-constructor records\nBen Franksen <ben.franksen@online.de>**20220429120907\n Ignore-this: 8125c7f3bebfe58acc589f50ba2551ec0d452dc6fe332d1ea182c41caf47cff32594da54f076895d\n] \n\n[TAG 2.17.2\nBen Franksen <ben.franksen@online.de>**20220513093526\n Ignore-this: bda65bc3dc68d0ee3af31fa6bf420ee54967539a84e0ac324bc7b680cb38da7ec5cdf9b1c8efe68e\n] \n\n[bump version to 2.17.2\nBen Franksen <ben.franksen@online.de>**20220513093431\n Ignore-this: ae0eb298bd51ae109d5c7bda3ce121084f8af47877b337de788e41425ed626b96f49641e095df596\n] \n\n[catch all IOErrors when removing temporary directories\nBen Franksen <ben.franksen@online.de>**20211122085340\n Ignore-this: 63004ebf109bdb034ea6a8cb94086cca9174fa5d754704905b0e957f6595c1a53eadc3f80a6ed85c\n \n I have occasionally observed tests failing in the CI that say\n \n  darcs: /tmp/darcs.log-75c76c279e1ab188_done/_darcs/patches:\n  removePathForcibly:removePathForcibly:removePathForcibly:removeDirectory:\n  unsatisfied constraints (Directory not empty)\n \n Catching these exception is justified because this is mere cleanup. Note\n that we already do the same thing in the cleanup part of withNewDirectory.\n] \n\n[remove a duplicate import\nBen Franksen <ben.franksen@online.de>**20211122085313\n Ignore-this: c07c83bb54d94eb9cf0fee1daee585dbfcf018184367fbd0da6a92c1e768c1537ffa51b4cbba1949\n] \n\n[refactor askAboutDepends and updatePatchHeader\nBen Franksen <ben.franksen@online.de>**20201103184646\n Ignore-this: 2b0a19d8493f0a6195954633337e4169f02ed61ac6304e690f808de5947d6aa6780ac51517a8d94f\n \n My immediate goal with this was to avoid making repository requests inside\n updatePatchHeader. Thus AskAboutDeps now contains a PatchSet instead of a\n Repository. But for the amend command the patchset we pass in is not the\n recorded patches but rather the recorded patches minus the selected patch.\n So we have to reconstruct this patchset. This is best done by not throwing\n away patches in the first place, but instead return unselected patches from\n filterNotInRemote as well as withSelectedPatchFromList. Incidentally this\n fixes a problem when we de-select the latest clean tag: before this patch\n amend would print all patches in the repo. This is now avoided by calling\n contextPatches when --not-in-remote is /not/ in effect.\n] \n\n[re-apply our changes to .stylish-haskell.yaml\nBen Franksen <ben.franksen@online.de>**20220429112542\n Ignore-this: b407b51bdeff6faa01c48ac9afa4ae1da7e1653c4f62baaf488c3258768abce4f50083bfb2cd02d1\n] \n\n[re-create .stylish-haskell.yaml with version 0.13\nBen Franksen <ben.franksen@online.de>**20220429112418\n Ignore-this: 91edbe86eed9b38cba2291243948c39c56d4b8f4a7a81c97f509e7b75f9ae98691bf69fdf0627f8e\n] \n\n[work-around to allow build with ghc >= 9.0 on Windows\nBen Franksen <ben.franksen@online.de>**20220428120533\n Ignore-this: fa4d0d9c76dbc968f633f18433f1241e0140590b1f2b0178fe4b7cf655cb3fc4669fea8a05260d2a\n \n We indirectly depend on ansi-terminal, with ghc-9.0 cabal picks 0.11.1 which\n is missing a lower bound on its Win32 dependency (has been reported upstream\n and will be fixed soon). This makes it hard to write correct cabal file for\n all supported ghc versions. The work-around is to reject version 0.11.1 of\n ansi-terminal.\n] \n\n[use fixUrl in clone command instead of ioAbsoluteOrRemote and toPath\nBen Franksen <ben.franksen@online.de>**20220427091826\n Ignore-this: 72d0545d6cbd17e66c5e1c5b3b286846a206151b44b79e572a34358ff2d0de10058572495a17e842\n \n This is how it is done for most other commands that take repository\n locations as argument.\n] \n\n[simplify addRepoSource by using getDefaultRepo\nBen Franksen <ben.franksen@online.de>**20220427091736\n Ignore-this: a8090eb56256840be9cc7a667277b27dd6acac6ad924e16efcef9e9a3eca529bd9854cf79bdc5f00\n] \n\n[simplify getDefaultRepo\nBen Franksen <ben.franksen@online.de>**20220427091659\n Ignore-this: 389f4c1dfdef3e4c84c04c7af5554666c97290eea1c67bc4c6afb5858a8b5ba1724a094b2f9b3540\n] \n\n[canonicalize result of getCurrentDirectory on Windows\nBen Franksen <ben.franksen@online.de>**20220427084954\n Ignore-this: e64eab8c7e8b34994365acbb8b637f00c4b473f0429c0cd6c2f057c39068c97d7dea746a7dd18d52\n \n This fixes problems detected by the CI. Before this patch we sometimes got\n DOS-style 8.3 directory names, which failed to compare equal to other\n repository paths with modern long names.\n] \n\n[fix problems with tests/issue189-external-merge-move.sh detected by the CI\nBen Franksen <ben.franksen@online.de>**20220424172154\n Ignore-this: 3ede71e278cf3e925f9c3a88c0a81223d9c03e8204bd7f5ebc7fc4ba6ef46b5f1e5104b4d25d4c94\n \n It seems creating a shell script and using that as external merge tool is\n not portable enough to work on Windows (even if we add the missing shebang\n line). So we create a small Haskell program and compile it.\n] \n\n[tests/push.sh: simplify test for push to self\nBen Franksen <ben.franksen@online.de>**20220426092504\n Ignore-this: 10316cd282fe76595074a6aaeee5642714ddb835ec59be7969f36ecacdfab70d41a22f85a4ea42c5\n] \n\n[Darcs.UI.External: inline execAndGetOutput and simplify\nBen Franksen <ben.franksen@online.de>**20220424123938\n Ignore-this: 89f68c829ded85c0d55122bc79e8adbcd60b37533ebe43bc95f6dfb7672879735549052b8205c0ef\n] \n\n[Darcs.UI.External: cleanup execPSPipe vs. execDocPipe\nBen Franksen <ben.franksen@online.de>**20220424122226\n Ignore-this: 195014c295ad60814b7cd254ec06b7740333bd21c80189588352e1f0d6d5859b5a1f599cc572ef78\n \n The Doc variant should be defined in terms of the ByteString variant,\n instead of the other way around.\n] \n\n[resolve issue2691: QC test failure for betweenLinesPS\nBen Franksen <ben.franksen@online.de>**20220424081018\n Ignore-this: ad12c0a5fd72281e5f759a41b08bd9590580c4f2714b9226b95e0963716c3f155183a32db2d3600\n \n This first fixes the test by introducing two newtype wrappers for ByteString\n to tweak probabilities such that betweenLinesPS actually finds the start and\n end lines (in order) in the input in about 6% of cases, which uncovered a\n few more bugs in the implementation of betweenLinesPS. The new\n implementation fixes them and also improves efficiency by strictly avoiding\n ByteString copying and allocations. Getting this right was more difficult\n than I expected, and would have been almost impossible w/o a specification\n to test against.\n] \n\n[improve some haddocks in Darcs.Util.ByteString\nBen Franksen <ben.franksen@online.de>**20220422125939\n Ignore-this: 86e642be85e2f0bc445663d018a4cc5ec12fb8a5abdfbbd07ba1d6ff995cd17ff5fa4013297a4d59\n] \n\n[add property test prop_linesPS_unlinesPS_right_inverse\nBen Franksen <ben.franksen@online.de>**20220424080611\n Ignore-this: 3abdd252a495d8a8903eda1dc8413e8a67ebd694c737661a320f010a2a4d453ef93edee0a7ebbd14\n] \n\n[fix a corner case of spec_betweenLinesPS\nBen Franksen <ben.franksen@online.de>**20220424074906\n Ignore-this: 16d2c5820470b621f593abac3dc5d6219495c6c14245d330d70d91ee1eca26dda6656ce0ca9c27bb\n \n This makes it behave in the same way as betweenLinesPS behaved when the\n start and end line are immediately adjacent.\n] \n\n[add test for (now resolved) issue2072\nBen Franksen <ben.franksen@online.de>**20220412151745\n Ignore-this: f28cb0e14807dc344008deccb084a2208a0c1192ee84f2751580b36e807da730fcc8873a82e4dd2c\n] \n\n[remove RepoPatchV1 speedyCommute\nBen Franksen <ben.franksen@online.de>**20220420185859\n Ignore-this: 5090bcd754fade21b96e01466763063e8c11feaad54450d3e2bc76a2b773b2ed939fd28872c21b0a\n \n Note that this was merely used as an optimization for the case where both\n patches touch a single file or directory, neither of which is a prefix of\n the other. It was previously limited to just files, using is_filepatch.\n Extending the optimization to include directories and relying on\n listTouchedFiles was regarded as too risky, which is why here we remove the\n optimization altogether.\n] \n\n[remove out-commented functions from D.P.Prim.V1.Coalesce\nBen Franksen <ben.franksen@online.de>**20190805080721\n Ignore-this: ea0fde294814422913bbd3d0f19668201ed8cea3322dd9a44527ebb3d1e2e0db071f182158444051\n \n This is recorded as a separate patch for easier review.\n] \n\n[separate canonizing from coalescing\nBen Franksen <ben.franksen@online.de>**20211117083628\n Ignore-this: 7ad0c99b727e6e7cf5179b8a280f4732d4c3cfca1d6783b1bb04dfd7d11e7100747e593d8b5b4e56\n \n This moves the implementation of 'canonize' and 'canonizeFL' to a separate\n module, eliminates the export of canonize, and renames class PrimCanonize to\n PrimCoalesce.\n \n The rationale for this refactor is that 'canonize' for single prims was the\n only remaining method from class PrimCanonize that actually had anything to\n do with canonizing. Its implementation does not depend on coalescing and is\n almost independent from PrimV1, with the exception that it removed patches\n with no effect, using isIdentity. This is, however, also done by\n sortCoalesceFL. Investigating the call sites of the canonize method revealed\n that some of them actually re-implement canonizeFL. The remaining two call\n sites (in Prim.Patch.Split and Darcs.Repository.Diff) now call canonizeFL\n with a singleton FL.\n] \n\n[extend docs for class PrimSift\nBen Franksen <ben.franksen@online.de>**20211117083628\n Ignore-this: 23afc7c34d0989dfcb1c1febe7eb973fd320b6f8198b53439663f167a5551eb86c07ee87651a4da0\n] \n\n[refactor and extend tryToShrink and sortCoalesceFL\nBen Franksen <ben.franksen@online.de>**20190802233801\n Ignore-this: 874da48ff3385f15a01d7ad1c5f9ca742eb0fb94950ef4a7e1ad4be3c2cf53f5ad1ab067a38de0a6\n \n This is a complicated patch that slightly changes the semantics of both\n functions. If one looks very carefully at the previous implementation of\n tryToShrink, it becomes clear that it is very similar to sortCoalesceFL. The\n difference is that tryToShrink doesn't bother to preserve the order\n established by its call to sortCoalesceFL. Whereas sortCoalesceFL takes care\n not to destroy the order it has already established. Both functions\n internally track whether shrinking has made progress, but hide that from the\n API.\n \n The new methods now both share the same core: sortCoalesceFL2. Similar to\n the old tryHarderToShrink, this function now tries harder to shrink the\n sequence than sortCoalesceFL2 did before. However, if this destroys the\n order, it takes care that it gets restored. It is thus able to find as many\n opportunities to shrink the sequence, while still maintaining the ordering.\n \n Internally, keeping track of whether shrinking has made progress is now\n structured as an effect of type (Any,), where Any is the Bool wrapper from\n the base library. This is a Monad due to the Monoid a => Monad (a,) instance\n defined in base, see the doc comments for details. mapPrimFL now takes and\n returns a function with a monadic effect, which allows us to map\n sortCoalesceFL2 directly. Which in turn allows us to change the return type\n of tryToShrink to Maybe, exposing to calling code whether we could shrink\n the sequence. This is used to avoid lengthFL calls when sifting.\n \n This patch comments out some code instead of deleting it. This was done in\n order to produce better diffs. They will be removed in a separate patch.\n] \n\n[define canonize outside of instance PrimCanonize\nBen Franksen <ben.franksen@online.de>**20190805084756\n Ignore-this: 4d21fbe18e2ce16159961299c0818be46b1f1f9f188bd6301a98c16858821c3646080347748314a7\n] \n\n[move canonizeFL out of class PrimCanonize\nBen Franksen <ben.franksen@online.de>**20190805082330\n Ignore-this: 684c754d3d6d582719874c0998018a81db90fd7866f9911e045053c484bd7c98bca9538fd6da06e7\n \n The definition of this function is independent of Prim.V1, it only uses\n methods from PrimCanonize.\n] \n\n[layout fixes in Darcs.Patch.Prim.V1.Core\nBen Franksen <ben.franksen@online.de>**20210216202120\n Ignore-this: ade4c8f46e4a2e3b02cae9b9966410f44281aba16786f85618b865717f9c88ef47a81bdf5aa37a7b\n] \n\n[remove evalargs in Darcs.Patch.Prim.V1.Core\nBen Franksen <ben.franksen@online.de>**20210216194755\n Ignore-this: 1627c10c6f98d2492c9409baf7bffd9f48ae0ea82c80ed3fc070985101e1091f841810388466c374\n \n All the interesting fields are already declared as strict in the data type.\n] \n\n[derive the Show instances for Prim.V1\nBen Franksen <ben.franksen@online.de>**20210216193751\n Ignore-this: e40605c60063e160d357c8b92682169db18f68ebd5bf193eef35071529f2801968db415c63b08248\n] \n\n[drastically simplify implementation of siftForPending for Prim.V1\nBen Franksen <ben.franksen@online.de>**20190801171930\n Ignore-this: 2363ff65cb958bb14154c2f3230cbe8cb274c22f227067d9b6f8628fb9cc0d613256798fe69e4f3e\n \n All the low-level optimisations have been eliminated. What remains is quite\n simple and easy to understand. Theoretically this change may cause\n performance regressions; but the optimizations only covered some simple\n cases like \"pending consists only of hunks, binaries, and setpref\" or\n \"pending consists only of addfile and adddir patches\". These special cases\n are handled just fine and without much overhead by the standard algorithm.\n Besides, the bottleneck in handling the pending patch is not sifting, but\n the complicated algorithm for eliminating recorded changes from pending.\n] \n\n[move instance PrimSift for Prim.V1 to its own module\nBen Franksen <ben.franksen@online.de>**20190801154508\n Ignore-this: 9ffeb5a9f23f3bb9e14a9b8734060ddd2e03f3387ef569c3f0b2e79f7e0e719431d3ec366a610ba7\n] \n\n[eliminate class PrimClassify\nBen Franksen <ben.franksen@online.de>**20190801154508\n Ignore-this: f7f39a64c32bb32a9dc249508a619470080d8e133d59563bfa6685e69f01e59ddbedd8ed61c09e34\n \n There were only three use cases left:\n \n (1) The whatsnew command used primIsHunk, which can be easily replaced with\n     isJust . isHunk.\n (2) The implementation of RepoPatchV1 used is_filepatch for speedyCommute.\n     This is now replaced with calls to listTouchedFiles. To account for\n     directory changes, we now check that neither file path is a prefix of\n     the other.\n (3) In the instance PrimSift for Prim.V1. Since this is specific to Prim.V1,\n     we implement the necessary functions directly.\n] \n\n[fix haddocks for pushCoalescePatch\nBen Franksen <ben.franksen@online.de>**20210207152619\n Ignore-this: df46b4e90c7da050e708aebca8bd4b737a0332f579092adcdf33cd69c5bb00b51f4643d18e4f0062\n \n Itemized lists require the points to be numeric.\n] \n\n[cleanup and simplify Darcs.Patch.Prim.V1.Coalesce.mapPrimFL\nBen Franksen <ben.franksen@online.de>**20190802203643\n Ignore-this: 6fe467bf631245fafe049c9d96e04f833508ba377688a71ac467f9d3ea41241fab404f4e77bd7c1a\n \n This eliminates the data type Simple. It is easier and more efficient (wrt\n memory as well as cpu) to put the original patches into the Map, rather than\n take them apart and afterwards put them together again.\n] \n\n[use (Bool,a) instead of Either a a in pushCoalescePatch\nBen Franksen <ben.franksen@online.de>**20190802233623\n Ignore-this: 538ae2f1bff7a53eaa89d43975177ccd356402f03ce125322ff740881bd8d17df11f70632e4899b8\n \n This is less verbose and more directly captures our intent.\n] \n\n[normalize code layout for pushCoalescePatch\nBen Franksen <ben.franksen@online.de>**20210207150213\n Ignore-this: 7c460795d70f7815ea0af5d3d73d510a111a7f33789c4f9caa9db7fd159693f1960223ec2be83c2\n] \n\n[resolve issue1981\nBen Franksen <ben.franksen@online.de>**20220412164924\n Ignore-this: 3ce6b926b313a3d30045c5e47d3282e17c66354611861ea37a29a218e6736b5fd963a7b4e0826a78\n] \n\n[accept issue1981: suggest repair when pristine files are missing\nBen Franksen <ben.franksen@online.de>**20220412162926\n Ignore-this: 21e494a15d85ff2a26e6c4533fdcee092043c597b606b314e68e8809b8dec28b3b377188913b4f29\n] \n\n[resolve issue1819: external-merge and no-allow-conflicts\nBen Franksen <ben.franksen@online.de>**20220412143240\n Ignore-this: b8c0e5e6756e5e2368477fc1da2b8eba6de24f7e39aa25b7ecd63771902bd7d0f80a4ac1071452f4\n \n The fix is simply to remove the code that deliberately tests for the\n external-merge option before failing in announceConflicts.\n] \n\n[resolve issue2646\nBen Franksen <ben.franksen@online.de>**20220412135010\n Ignore-this: 8d9f8f9029ecd6d15f884aadb006a78e1f1cc70b40d9a407a16eb9de1c123d3d813c81f1f141f36a\n] \n\n[patch index: disentangle Darcs.Patch.Index.* modules, rename PatchMod to FileMod\nBen Franksen <ben.franksen@online.de>**20211004080939\n Ignore-this: ac59088cf63cb273f80986055b3efe7ea89545bcef4e011dc6aee72cb038b9621264dab537edc48b\n] \n\n[patch index: cleanup doc comments\nBen Franksen <ben.franksen@online.de>**20210610120909\n Ignore-this: 8338b392d1a22f71122e0c2f6bd7fcfc4524fed5ed473967aaf586ebab535b0ccc0c77783007778a\n] \n\n[patch index: optimize Set Word32 -> IntSet\nBen Franksen <ben.franksen@online.de>**20210610121541\n Ignore-this: 3f64ba8278cc2a83401775d65ffb0220990977242083054901d791021b0e2d98eafd3a664c2ed61\n \n This trades a bit of memory (at least on 64 bit archs) for the ability to\n use an optimized data structure. The version number gets increased to 5.\n] \n\n[patch index: massive performance improvement\nBen Franksen <ben.franksen@online.de>**20181004160731\n Ignore-this: d02cd79fc9d674d6432479c574f9d971a6b7fa3c5c46049cff63db8b6117ae09c3ce21d32409e9a6\n \n By definition, a directory is regarded as touched whenever a file or\n directory beneath it is. This information was laboriously re-constructed at\n query time (in maybeFilterPatches), which could be very slow when a\n directory had many children. It is much more efficient to add this\n information immediately when we build or update the patch index. This\n requires no change to the data structures, just additional inserts.\n Nonetheless, this is a format change, so we have to increase the version\n number to 4.\n] \n\n[patch index: reformat a doc comment\nBen Franksen <ben.franksen@online.de>**20210610120501\n Ignore-this: 665a824caca2b970d25fabf22eb85d688bec52632d00d77ee9ebeb292d32d473856329b9aebb4d9c\n] \n\n[patch index: import from Darcs.Patch.Index.Types explicitly\nBen Franksen <ben.franksen@online.de>**20210610120619\n Ignore-this: 55342c521619ad0b3d0a206affc765a6b6214b62f22166e71057b4349e4d482a5663e5081f55bfa4\n] \n\n[patch index: debug messages when loading\nBen Franksen <ben.franksen@online.de>**20210610120949\n Ignore-this: 66b640cde02f352c7905afe48b4cfa6067b041f3ebc1af5e6389ea565e428b05ddbb607a9d0cb0f4\n] \n\n[patch index: remove another kludge for broken move patches\nBen Franksen <ben.franksen@online.de>**20210610190038\n Ignore-this: d5fa46e3cfd90d65313facc204d8cbdada8048b223468f79272f9c3830474807c224364ab25677ac\n] \n\n[replace undefined with error calls for missing methods\nBen Franksen <ben.franksen@online.de>**20211203054657\n Ignore-this: 20661aa6ba3a359da46ba2734d7596991ca3bd471f7b8634b64030bf8ef5870552f7fdb7d4d6dfac\n] \n\n[require MonadThrow from the base apply monads\nBen Franksen <ben.franksen@online.de>**20210919120041\n Ignore-this: 8b6138c45749e96828be7a9e9b71458228b0c71475e98dce0762648d7aa56f122d34a82f64ab1a82\n \n This avoids having to throw from pure code when applying patches in a monad\n that is not based on IO. In Prim.FileUUID we now correctly handle all patch\n application errors as exceptions. In D.P.ApplyMonad, the FilePathMonad is\n now a StateT over a Pure monad with an instance MonadThrow that calls error;\n in the harness, the Fail monad is now a synonym for Either SomeException.\n] \n\n[catch all takeLock exceptions in withLockCanFail\nBen Franksen <ben.franksen@online.de>**20211108160839\n Ignore-this: c574accb8be23d198e0bbee14e1cccb2b146c8100aa4ee9bb6a99ebfe557106e2e9fee921fb2d4dd\n \n Note that withLockCanFail is used in commands that are otherwise read-only,\n such as annotate and log (with a filename), in order to create a patch\n index. These commands should not fail if taking the lock fails for whatever\n reason (e.g. no write permission). This is important for instance when using\n darcsweb.\n] \n\n[tag command: prompt for the tag name if argument list is empty\nBen Franksen <ben.franksen@online.de>**20210627080534\n Ignore-this: 3c70f157ed9f3b3e0301c68769557cd5ed1cc59d7324dc7baf70006c0dfbdb6ac8d6365045612bf\n] \n\n[tag command: clean up imports\nBen Franksen <ben.franksen@online.de>**20210627075730\n Ignore-this: 2b6a9706d3531d900959c54cbef7cb4b2e7ba1e33ba2c676224e181bd74c8507fbd9bf7c4f710ef\n] \n\n[Darcs.UI.PatchHeader.getLog: take summary of changes as argument\nBen Franksen <ben.franksen@online.de>**20210627075202\n Ignore-this: 38265b7ed5ece5316161c40cca0ae7db6a1eb1e59a3a49d133dc0f49515cf65b83abc583ad676d52\n \n Instead of passing the changes, we now pass their summary. This avoids\n verbose and ugly type annotations to avoid ambiguities when passing NilFL in\n the tag command.\n] \n\n[tag command: in get_name_log, use 'args' from the outer scope\nBen Franksen <ben.franksen@online.de>**20210627073934\n Ignore-this: e74a2a28bf027070de64a2a8be45aeac93b289b82b99cd4dfa312ca630656adfdf34e621fb1a239b\n] \n\n[tag command: reformat the where clause of tagCmd\nBen Franksen <ben.franksen@online.de>**20210627073809\n Ignore-this: 673a97d985ca66ee53f7f5bbcd34ab5e53ef12631273619f094e69635c3f4a1b99f11c9dc89b7dd8\n] \n\n[tag command: refactor hasPipe\nBen Franksen <ben.franksen@online.de>**20210627072002\n Ignore-this: d3861107d475474372ee623ced02f64598def725eea85cd060c16846cc163fe73b70db12e4d0a75e\n] \n\n[tag command: improve help text\nBen Franksen <ben.franksen@online.de>**20210627071800\n Ignore-this: a56cdcdbed1e238754f57db719d71019ccd58e64b6b258d4cd6b0346897577339a2fbd5fd75e7376\n] \n\n[auto-format help text for tag command\nBen Franksen <ben.franksen@online.de>**20210627062550\n Ignore-this: 59f715042939c55d5b80ab6513aa1567c278789339bf62a0d1475df678cb68e635b2a746c865e644\n] \n\n[remove type ConnectionError, remove Darcs.Util.Download\nBen Franksen <ben.franksen@online.de>**20210623082607\n Ignore-this: ee6db6842ba76617d506bec3f0373d42dc33964480785d7611e55fb646de98f3cd581fd4314b098f\n \n The data type was only used in checkCacheReachability and in a way that no\n longer worked anyway. The remaining item in Darcs.Util.Download was the\n Cachable data type wich is now defined in Darcs.Util.HTTP.\n] \n\n[import ConnectionError unqualified\nBen Franksen <ben.franksen@online.de>**20210622163331\n Ignore-this: 4d7463e525b1c023aad7eb492db2a6f4adda992351978975b2532a1ed58482cfea372192711955a3\n] \n\n[remove support for downloading via curl\nBen Franksen <ben.franksen@online.de>**20210622161934\n Ignore-this: 61e4875b4d8e424c9227cb4706f7ad0ab4ba9e5f77e2fd5317a4729dee315ec64d6111d5c2781fff\n \n This includes the cabal flags 'curl' and pkgconfig'. It also removes the\n --debug-http and --no-http-pipelining options, and replaces the combined\n network option with remoteDarcs. The module Darcs.Util.Download.Request is\n also removed, the only items that are still used are two data type\n definitions which are now defined directly in Darcs.Util.Download.\n] \n\n[remove the unsafe tentativelyAddToPending, replace with addToPending\nBen Franksen <ben.franksen@online.de>**20210302150625\n Ignore-this: cce3b2d0ecab7060153fa6a357efa83f22c2b0f1e60d57b631ccef7f1b9a6660a30d3b48f353dd7d\n \n The fact that this type checks witnesses the fact that indeed using\n tentativelyAddToPending was wrong: the patches we pass all start at the\n unrecorded state and thus should be commuted past the difference between\n pending and working before appending them to pending. This is what\n addToPending does which is why it is the safer choice here.\n] \n\n[rename addPendingDiffToPending to unsafeAddToPending\nBen Franksen <ben.franksen@online.de>**20210302132611\n Ignore-this: c64370f6ea0a98e2db90a644b6ac511751f998fdb4182c42de9f18ff1c2c8f3dd8a9849800da8236\n] \n\n[ci: run tests concurrently (6 jobs)\nBen Franksen <ben.franksen@online.de>**20211105202439\n Ignore-this: 5f69156e53f5b52b7137077883d72d70652d4a973cbd5c5718be4dff9b742f825a4f77a8e4748508\n \n I have observed that this makes the tests run faster, especially on macOS.\n] \n\n[ci: allow empty commits\nBen Franksen <ben.franksen@online.de>**20211105202358\n Ignore-this: 7e737cf04f5a08d659156e476a09e8623d4cd83c0ef0593a8aef3ad401655f1d170b2c1e8cb29a\n] \n\n[generalize readPatchesHashed and use in readTentativePatches\nBen Franksen <ben.franksen@online.de>**20210327055207\n Ignore-this: 5c1771aacdbc2ee22e02e37e46b5b72621c02fa5bfa5b703ea803da6a7854c13c3529170d1fbc57b\n] \n\n[replace readTentativePatches with readPatches\nBen Franksen <ben.franksen@online.de>**20210301201958\n Ignore-this: 98d4665d77887ce616540cc11ade28616e4c1458303a8341e01a479bebde69c383dfb905bc6b0bd\n] \n\n[import tentativelyRemoveFromPW via Darcs.Repository\nBen Franksen <ben.franksen@online.de>**20210301152620\n Ignore-this: bb37ef9fe31d2be6d830cf23faff248870b333e4040f91b84fa6b0c0f966d90526f22f12dea71788\n] \n\n[ci: fetch before commit\nBen Franksen <ben.franksen@online.de>**20211105143643\n Ignore-this: 1127b44c6b77869cc0ca6b8ffeda50c737fa6e62e4d62194be758e90a4524f038f29a2492ec7d4f3\n \n This works better with the recent change that makes us share a single\n branch: rather than force-pushing our local branch, we now first fetch and\n then set our HEAD to master. To completely re-initialize the git repo, pass\n the argument \"init\" to the script.\n] \n\n[ci: use only the default (latest) version of each OS\nBen Franksen <ben.franksen@online.de>**20211105141833\n Ignore-this: 77f372e4b03493b65ee149a5ed1dd301afad1f3a47f70033b19e38fbfc6d404f86afc94c0407779c\n \n This makes the CI runs faster because we don't have to wait for runners to\n become available.\n] \n\n[use withRepoDir in createPacks\nBen Franksen <ben.franksen@online.de>**20210315162432\n Ignore-this: b7141bfd23d7c787f27eb919010c08aec95162bffbfe4775fdff3a1e5868c5a85a46e331290f86d9\n \n This simplifies its use in darcsden.\n] \n\n[fetchAndUnpackPatches: fetch inventories, too, pass valid hashes, not String\nBen Franksen <ben.franksen@online.de>**20210717084010\n Ignore-this: bb7311cbce7399d3e5903d68601431d3b7fa6096b0f92e1a2a0af4ed24674f5f707facac9395bdfd\n \n When we unpack patches and inventories from the pack, we previously fetched\n the necessary patches in parallel, for guaranteed completeness. We now do\n the same for inventories, so that when the remote repo has been tagged after\n the last time packs were updated, we still get the repo in its most\n efficient form. This requires passing the inventory hashes as well as the\n patch hashes. To improve type safety and efficiency we now pass lists of\n InventoryHash and PatchHash instead of String, which avoids encoding and\n then decoding and the extra failure mode due to these conversions.\n] \n\n[convert import/darcs-2: recognize the compress and diffAlgorithm options\nBen Franksen <ben.franksen@online.de>**20210303145001\n Ignore-this: 85558b53cb6d96f71f8f685002d80e3a8f41fa88b023194b59df8fa17f2436eab6aeb1f95ea6ebc3\n \n This avoids hard-coding some arbitrarily chosen value.\n] \n\n[convert darcs-2: remove intermediate commits\nBen Franksen <ben.franksen@online.de>**20210617101048\n Ignore-this: fc35c5ca37a0014148a274c6e953b147759f898249e72249ee0aca4118e1f0f341e06f45ce258a33\n \n There are two reasons for this change. One is that intermediate commits open\n a brief window in which the repo is not locked. Since this happens in a\n newly created repo, this is not of much practical concern and more a matter\n of principle. Second, intermediate commits serve no purpose. If conversion\n runs into an exception you will end up with a partially converted repo (the\n state of the last commit). This is quite useless, since there is no way to\n restart the conversion at this point.\n] \n\n[convert darcs-2: honor the compress option\nBen Franksen <ben.franksen@online.de>**20210303143641\n Ignore-this: 4178cc4194d62d3fa7593c1eef428eed7ce98933308d1614584e683cc3b3030021553fb0acb605bf\n] \n\n[convert darcs-2: add a final call to finalizeRepositoryChanges\nBen Franksen <ben.franksen@online.de>**20210303142815\n Ignore-this: 17c6f2ca4af83cde9b7f0cf3a3d7963133eb8a87ae9229cd95131b9ad50dedc7661d1b883db9d5\n \n This is more a matter of principle than necessity, since the code does work\n without the call.\n] \n\n[ci: more descriptive name for the git commit\nBen Franksen <ben.franksen@online.de>**20211105091710\n Ignore-this: 14c677925a8645ff4207252355426fcbb05de7673a816b463898af25a671e02843c97ba4eeec91c\n] \n\n[ci: remove branching from release/trigger-ci\nBen Franksen <ben.franksen@online.de>**20211105084919\n Ignore-this: 444f6f6b7ee6f29d18f2ea47249d9a95c16185fb74c3b5978f17441042b2ce7dc1320c5c62109618\n \n I found out that this interferes with caching: when you trigger CI on a\n different branch, the caches from a previous run in different directory\n aren't used. We now do everything on a single branch named 'master' to allow\n sharing of caches.\n] \n\n[fix in Darcs.Patch.PatchInfoAnd.fmapH: must invalidate hash\nBen Franksen <ben.franksen@online.de>**20210718141537\n Ignore-this: 8a9610a2e0f504501f94adf929e4bf9850364340da08a38dbe19588ef5c874d0824f30b268b2a28a\n \n The function we map over the contained patch may modify it, so any hash\n we may have had is now invalid.\n] \n\n[cache: eliminate hashedFilePathReadOnly\nBen Franksen <ben.franksen@online.de>**20210530083542\n Ignore-this: 6b7b737d8242d0fce556e0ca1fdefa51ab3f7a156088bd7dbc4e9e642c0df129ac94eb6f401f933a\n \n Since we pass the CacheLoc, we can make the distinction between bucketed\n (writable) and non-bucketed (not writable) cache inside hashedFilePath.\n] \n\n[refactor updateHashes in TreeMonad\nBen Franksen <ben.franksen@online.de>**20210421083122\n Ignore-this: a4dd8fda4fb083a73f1d55f029dcdc3e363b0762a7aa9832ec568dbe07fabf3e7f789bfea5073c49\n \n The central change here is in the type of updateHash from\n \n   TreeItem m -> m (Maybe Hash)\n \n to\n \n   Maybe (TreeItem m -> m Hash).\n \n Indeed, for a concrete instantiation we either have a total hash function or\n else no hash function at all. In the latter case this change avoids calling\n a procedure that always returns Nothing, potentially recursively over a\n large tree. It also gives us more precise typing.\n \n Everything else follows from that, with the exception of 'flushItem' which\n was rewritten to make it clearer what happens: we first update the hash,\n then update the item on disk and then replace the item in the tree we are\n tracking.\n] \n\n[move reading and writing of inventories from D.R.Hashed to D.R.Inventory\nBen Franksen <ben.franksen@online.de>**20210327061805\n Ignore-this: 300dc2023972e7d9d709d21de95153a63e0cdb279d6debacd1c54c1017eb22d6a9b00d87073e0d96\n \n This is a pure code move, except that I also cleaned up the layout of the\n import lists in D.R.Hashed.\n] \n\n[fix a FIXME: HashedDir mismatch in the handling of packs\nBen Franksen <ben.franksen@online.de>**20210716150629\n Ignore-this: b63b49a3deda117bca42618fded8b7db7833d065cf5503010a068f139501284045bb95b12b21c209\n \n It turned out that the HashedDir parameter wasn't used anywhere, so this\n patch removes it. This makes sense since filepaths in the pack files already\n contain the subdirectory of all files.\n] \n\n[major refactor: internally store valid hashes in parsed form\nBen Franksen <ben.franksen@online.de>**20210416112403\n Ignore-this: 6b4382f578cac191e53a094f1649dad6ca6e42aa041ec58493e3b8931aaa8d076c2077a689317a3b\n \n The main theme here is the \"parse, don't validate\" mantra. Storing hashes\n (optionally including the content size) in parsed form is memory efficient\n and gives us much better typing. The code for this has been moved into its\n own module Darcs.Util.ValidHash with a safe API. PatchInfoAnd now stores its\n hash as a PatchHash and the Tagged sections of a PatchSet store their hash\n as an InventoryHash. The HashedDir is now inferred from the type of the\n hash, which means we no longer have to pass it to the function exported by\n Darcs.Util.Cache, which simplifies the API and makes it more type safe (yet\n note that not a single 'forall' had to be added to type signatures).\n \n This refactor exposed a strange HashedDir mismatch in the handling of packs\n that I temporarily marked as FIXME. I suspect that some files are not placed\n in the right directories, resulting in a loss of efficiency when cloning\n packed repos. This needs further investigation.\n] \n\n[move D.R.Inventory to D.R.Inventory.Format\nBen Franksen <ben.franksen@online.de>**20210327054814\n Ignore-this: 32dd92b2be5f2ab200d7f349372086cb6ac4e2def2b09ac8b1e3f3a1c80cab63801b3b00ead079c1\n \n This is so that we can move the code conerned with reading and writing\n inventories to D.R.Inventory w/o mixing the inventory format with its\n interpretation.\n] \n\n[cache: inline copyFilesUsingCache\nBen Franksen <ben.franksen@online.de>**20210307101327\n Ignore-this: 1039cb3158ce64caec81b74958e68546a7c5c1f6ff62a7cc5b1adfe3ade34b49bbc3bcf03d100b5d\n] \n\n[cleanup parsing and unparsing of hashed directories\nBen Franksen <ben.franksen@online.de>**20210417101623\n Ignore-this: c1a6450fba98053feee3e470f78a99dcb98f7ed42b4ce4029e5d133f9081b27ac7932f7acfbbba35\n \n The parser now uses Darcs.Util.Parser. The function decodeWhiteName which is\n used by the parser is now explicit about decoding errors. In contrast, the\n unparsing is actually *not* supposed to fail: it has existing hashes for the\n subitems as a precondition; indeed we call hash update functions in various\n places before calling darcsFormatDir. As it stands this is quite brittle and\n should be improved but this has to wait for another patch.\n] \n\n[fix generator for hashes in D.T.R.Inventory\nBen Franksen <ben.franksen@online.de>**20210324023216\n Ignore-this: 942b9deff9c67365da5f57e55670502bd5892dd64771edc5e69cca26e5ab426c8f5d215c3d5b9682\n] \n\n[use decoding to validate hashes\nBen Franksen <ben.franksen@online.de>**20210416095352\n Ignore-this: d6c7a2a1a7d27ab95187de10d35f9c597f09fe71745ac967ec37436a770aa5d2a6aa16133ee5fde8\n \n This also delegates the implementation of okayHash to okayHashB.\n] \n\n[make possible non-existence of hashes explicit\nBen Franksen <ben.franksen@online.de>**20210412055417\n Ignore-this: 842dc617ace1f53ed410d5f04615523513181b3937607f1a99057dba6d25d2516e962772f7057653\n \n This removes the NoHash constructor and (more or less mechanically) replaces\n Hash with Maybe Hash. This exposes lots of situations where we missed out on\n more precise typing i.e. where we know we have a hash but still work with a\n Maybe Hash. This patch doesn't clean these up, it just allows and encourages\n us to do so.\n] \n\n[move hash validation from D.R.Inventory to D.Util.Cache\nBen Franksen <ben.franksen@online.de>**20210327075324\n Ignore-this: d020f2ac5800819b5eba063a53901aa2f64ccb1222354bad6ed556d89a67945d273e225fb3c39ad9\n] \n\n[validate hashes in inventories on the ByteString side\nBen Franksen <ben.franksen@online.de>**20210314083456\n Ignore-this: 87fc6ffe037ab46a792e4466db85b028f92e593edb2219529dbd6f7c814e9c1610e7a8e76e4ab835\n \n For reasons I haven't been able to figure out this drastically reduces\n memory consumption.\n] \n\n[avoid re-validation of already validated patch hashes\nBen Franksen <ben.franksen@online.de>**20210308093608\n Ignore-this: 9c03b65a47f366271b0beee735a3e8d6b5e72fe0031d405d4d701caee84c89fc646e8d3408493b18\n] \n\n[cache: refactor cacheHash and remove export\nBen Franksen <ben.franksen@online.de>**20210307101410\n Ignore-this: bb33fb17c07c2e8300ceb4731969faf823dc175a37e6fc2881ff4a00160a0a97b7b26a4e7ba79e05\n] \n\n[use ShortByteString for Hash content\nBen Franksen <ben.franksen@online.de>**20210307162525\n Ignore-this: 343006f7acead5b3f3d044b3454fc7e6370d7d9ec177b13f45bf9c365c88b0e4a8e414a128c1cb37\n \n This should bring down memory use and decrease fragmentation.\n] \n\n[ci: fix primary key for caching dist-newstyle\nBen Franksen <ben.franksen@online.de>**20211104105043\n Ignore-this: 1e79356ff7ddbb9bb30843652341020ff486aae44f4469cb1fd0dbd496ec28eb850e1fcf1c7dbe7a\n \n Cabal will re-compile everything if the build plan has changed so we also\n need add this file to the hash.\n] \n\n[remove the useless optimize pristine subcommand\nBen Franksen <ben.franksen@online.de>**20210510113544\n Ignore-this: 1c75fd4ccfbe80df50059810df5d91dcf60cc4fd7c5b6715a01ec5761df701a451a636763f654133\n \n Upgrading the pristine from the size-prefixed format is done automatically.\n] \n\n[fix the order of parameters to Tagged\nBen Franksen <ben.franksen@online.de>**20210327050259\n Ignore-this: c8c6812ba8b25fa932a134d5a4839b300ab98442484799fbab71704be4fcf6716391e8fe44a2c322\n \n The order is now 'Tagged patches tag hash', i.e. patches come before the tag\n that covers them. I should have done this years ago when I established the\n convention that patches always appear in left to right application order.\n] \n\n[return hash from writePristine\nBen Franksen <ben.franksen@online.de>**20210324172607\n Ignore-this: 92cfee04b27714e70f51b42bb3c107c231f17ba497071e89dd04b6054911259a782a66260c03c562\n] \n\n[simplify writeInventory and writeTentativeInventory\nBen Franksen <ben.franksen@online.de>**20210324053723\n Ignore-this: cc354cfc9ccdfe121d8356195aad6f4a7b00bbbb08286282a03376b12b6bd7039f09af604b908f14\n \n The simplification consists of no longer treating empty inventories\n specially. It involves is a minor change in behavior in that an empty\n inventory is now written to disk as a hashed file; which is the reason we\n have to adapt tests/issue1987.sh. Indeed, my original motivation for the\n refactor was so to make writeInventory return a hash unconditionally.\n] \n\n[lift writeInventoryPrivate to the top level and rename to writeInventory\nBen Franksen <ben.franksen@online.de>**20201103063416\n Ignore-this: ec7d61553da2ce9972616ec2ef2d3e63f4158d3b054f34ad41ea26ec3ef9d5a0d66b08e9e1f153a5\n] \n\n[ci: add macOS-11 and windows-2022 to matrix\nBen Franksen <ben.franksen@online.de>**20211103163757\n Ignore-this: d336271ef6a2692df63214648ae59ae4bc96f4065c62161767db9bbf96e8dec0ae62259ef7ba91fe\n] \n\n[ci: install lighttpd before running tests on linux\nBen Franksen <ben.franksen@online.de>**20211103163505\n Ignore-this: aa8ef8ff04bac161a2f23a2610e02ccd4f81bcc3ec66ebc3d25b6a8062d101f2340f21a09f3d3d38\n \n Otherwise most of the network tests are skipped.\n] \n\n[ci: add ghc-9.0 to the matrix\nBen Franksen <ben.franksen@online.de>**20211102115521\n Ignore-this: 59fe796c2aef30e6e5ad81364eca47d4e53ec6f9c27e34285a8c1ab0bce6784aa24b7b38f5d1027c\n] \n\n[ci: always use the \"latest\" version of cabal\nBen Franksen <ben.franksen@online.de>**20211103113421\n Ignore-this: de44ad0f54458cfd19542eed22d590b2bcc1b544099524942e61deb66534e2db627d2123c46c4863\n \n Including several cabal versions in the build matrix is problematic for\n caching and blows up resource usage unreasonably. Besides, cabal-3.2 cannot\n be used with ghc > 8.10, which would then require more exceptions.\n] \n\n[ci: actions/setup-haskell -> haskell/actions/setup\nBen Franksen <ben.franksen@online.de>**20211102112845\n Ignore-this: 10bba56fd4f20a8b9ca2e0c89bd90ed8517bcff7c86eb0d3d3d36492461adddae917281feffc9ede\n \n The former is no longer maintained. Also let haskell/actions/setup choose\n the precise versions and specify only the first two version components. This\n is more robust and allows us to remove the macOS-10.15/ghc-8.10.4 exception.\n] \n\n[fix for tests/network/external.sh failure on ubuntu with ghc-8.10\nBen Franksen <ben.franksen@online.de>**20211102161252\n Ignore-this: 631c34c194838119d7eb847403e6d5033739ac1f1833350f5d063953fe982a7973444dcce3c5e70\n \n This also slightly re-organizes the script to make it easier to understand\n what's going on.\n] \n\n[ci: redesign caching of cabal store and dist-newstyle\nBen Franksen <ben.franksen@online.de>**20211103113842\n Ignore-this: e96d0c04ade05e53ef511786f33892e8186bcef0cc96c0e5ed95b1c522ba9006c93ebf77044586f3\n] \n\n[tests/broken_move.sh: adapt to better apply error messages\nBen Franksen <ben.franksen@online.de>**20210317074545\n Ignore-this: 999e8c6a0f46b5b2084dca38822af25cf68c9e324f3a5a3e5329397d774d95993cac3c3b9667eb6a\n] \n\n[TreeMonad: add two comments and some code re-formatting\nBen Franksen <ben.franksen@online.de>**20210620072923\n Ignore-this: 18cf64425f9a03312e6c14b831b68fef1f249bd4ab6ec408a6a3661919283917c985f2f9eb832988\n] \n\n[TreeMonad: more fine grained error checks\nBen Franksen <ben.franksen@online.de>**20210323144929\n Ignore-this: d49beba317aca1d06c5e94226644e7d5d277cae2915db05eb500782aa589cdb014f79f74f08cfa71\n \n In particular, 'readFile' and 'writeFile' now distinguish between\n non-existence and inappropriate type (directory), and 'copy' throws an\n exception when the source item does not exist instead of doing nothing.\n Since System.IO.Error does not export a function to construct an\n InappropriateType IOError, we no longer use the constructor functions, but\n instead import the IOErrorType from GHC.IO.Exception.\n] \n\n[TreeMonad: explicit import of D.U.Path, some simplifications\nBen Franksen <ben.franksen@online.de>**20210316072251\n Ignore-this: bd080c44431b62746a21a1f508eb3a1b03f41993494e26290d09b16eb92f2f9af9849eb781ca92e6\n] \n\n[TreeMonad: factor out findItem\nBen Franksen <ben.franksen@online.de>**20210620070138\n Ignore-this: 956660de8d73e6595a8d895a3b3810a49d4e21e41f8b20701f1dbd7c7925d2126090cfc0344509b6\n \n This will later allow us to throw more precise exceptions.\n] \n\n[better error handling when applying patches\nBen Franksen <ben.franksen@online.de>**20210314220059\n Ignore-this: 7435723695779f02418fae12f5326c3b029a23ba9dd1aa67cbce525f41c74dca35f7cea67476426d\n \n In the TreeMonad we now throw the IO errors that fit the situation instead\n of userError. This allows us to give getter warning messages when using\n runTolerantly. In addition, if we cannot run tolerantly, i.e. when we apply\n patches to pristine, we now notify the user which patch caused the problem\n and suggest to run 'darcs repair' on the repo that contains the broken\n patch. This is important because we no longer silently ignore broken move\n patches.\n] \n\n[re-write of release/gen-version-info.hs\nBen Franksen <ben.franksen@online.de>**20210710073431\n Ignore-this: 974d34cc9a9940dde3ea8a93b076edfb1e4a16ccd7cc2cd62a52be42e585c3b2204c4a6e3277cde2\n \n This simplifies the logic but also replaces the test for existence of _darcs\n with catching all IOExceptions. This makes it more robust in case executing\n darcs fails for some other reason.\n] \n\n[release/gen-version-info.hs: fix missing check for existence of _darcs\nBen Franksen <ben.franksen@online.de>**20210707115839\n Ignore-this: 9ef1aae66c2e75f6232bedb06ece11aee9f213691f5e3d422e1c6bb38d5957b8aab411b14eaa610b\n] \n\n[HasCallStack: withCurrentDirectory, withRepoDir\nBen Franksen <ben.franksen@online.de>**20210708183714\n Ignore-this: d43f561a9683aefc36d78b7664c5c4bdc09e883f23ae60d53101b18eea330cbb6731889c66a21ca5\n] \n\n[fix in checkSuspendedStatus and maybeDisplaySuspendedStatus\nBen Franksen <ben.franksen@online.de>**20210228104448\n Ignore-this: 6c90b32f275a99e6d66cdd05bac997aaa1dae3a1694db9326e4c1fa979a57798cee6f34e83c308cd\n \n We must not try to access either of the rebase patch files if the repo\n location is a remote URL.\n] \n\n[setCurrentDirectory: call error if argument is a remote URL\nBen Franksen <ben.franksen@online.de>**20210708083314\n Ignore-this: 6435e3d0c3b580f680958acb56b67f0f6e5c71ae536770628c3a8f134476ffad9cc519e5315e01a\n] \n\n[resolve issue2682: conflict not marked if tag pulled at the same time\nBen Franksen <ben.franksen@online.de>**20210705075417\n Ignore-this: 3527f75992b5d674be9d5f3e7347b5bdb2a27d326c8cf53676523be0f7860fd0abd6825dcc08569d\n \n The fix is to consider a conflict as resolved only if all conflicting\n patches are (transitively) explicitly depended on by a single patch.\n] \n\n[avoid use of the instance Named (Conflict p) for rebase unsuspend\nBen Franksen <ben.franksen@online.de>**20210705112751\n Ignore-this: 99246554ea7f171c551fc57cbdfc8d882e8a7cd68460abbf3c44ff96dfdca1f730ea23ac44779b8c\n \n This is so that the fix for issue2682 does not break rebase unsuspend, but\n it also makes sense independently: when unsuspending patches we definitely\n don't want explicit dependencies to count as conflict resolutions.\n] \n\n[add findConflicting to Darcs.Patch.Conflict\nBen Franksen <ben.franksen@online.de>**20210704212926\n Ignore-this: c8d14eed7ca3a261a4c6000b448135e016b2a6f5613d4d16d40b908dee40994a47c1b0ec1064b4c8\n] \n\n[re-add isConflicted method to class Conflict\nBen Franksen <ben.franksen@online.de>**20210704210248\n Ignore-this: e6fda415ff4ed6ea7a079f717f20d7d615edcbbdb3c85076a66c526c4fb1ba075fff8a630c2715b3\n] \n\n[improve test for issue2682\nBen Franksen <ben.franksen@online.de>**20210706160306\n Ignore-this: 68ebd0188216cd1a9005f4967e81791db5d38c92a195b15e89490117093e4698db9f06b3ddddc4f3\n] \n\n[accept issue2682\nBen Franksen <ben.franksen@online.de>**20210705074510\n Ignore-this: 92f39b09069c18d1ff3189cb4140fbe9add83d400b09b1056f41d4ac7b42a63b11fc4c948662d0ec\n] \n\n[decouple IsPrimV1 from ApplyState p ~ Tree, simplify runJob\nBen Franksen <ben.franksen@online.de>**20210323143203\n Ignore-this: 7831d21dc0347f2a8edfcd5d27363f04bf3213d5117acdb23f4778b545ca54ae3847fdcd2acb0509\n \n The extra 'ApplyState p ~ Tree' constraint was only for convenience, the\n same effect is achieved with a separate call to checkTree. The rest of the\n changes is replacing case matches with 'Dict <- return checkXxx' which I\n find leads to more readable code because it avoids extra indentation. And\n since all cases of runJob require the 'ApplyState p ~ Tree' constraint\n anyway, we can now float the checkTree out of the large case expression.\n] \n\n[get rid of \"nasty hack\" in applyPatchesForRebaseCmd\nBen Franksen <ben.franksen@online.de>**20210302104856\n Ignore-this: 4a83d729e21985c54f7431099874563338df07e206c87e680d80c8b5a032b5a3c2c5b5465fac63f3\n] \n\n[make pending and unrevert follow transaction protocol\nBen Franksen <ben.franksen@online.de>**20210302092935\n Ignore-this: b5d9d59fc0d03a6dfc1a67507a035a59e5a1350f784ced55780cd19b70faca606ae9f7a623e8c72d\n \n This means that all modifications are made to the tentative versions and\n that we define and systematically use revert/finalize.\n \n Note that the implementations of revertTentativeUnrevert and\n finalizeTentativeUnrevert are tricky: the case where we have no unrevert\n bundle present must be handled carefully.\n] \n\n[make D.R.Traverse procedures RW so they work on the tentative state\nBen Franksen <ben.franksen@online.de>**20210303141232\n Ignore-this: bc5346f4bf3470f5189972bac38a7cbd615b2af86293448910dd4c27dcb3004667b6ceb5056bfeee\n \n This required fixing convert import where cleanRepository was called after\n finalizing the transaction.\n] \n\n[remove the tentative state witness parameter for Repository\nBen Franksen <ben.franksen@online.de>**20210301151635\n Ignore-this: d2baeed808cbb74b9a12361abe84f090d8e7e5db6d787c0ba1943c14a17a8f71ecc6e1c26d4fc8cc\n \n Since we now distinguish at the type level and at runtime whether we are in\n a transaction or not, it no longer makes sense to keep the distinction\n between the recorded and the tentative state: inside a transaction the\n recorded state is irrelevant and should be ignored, while outside a\n transaction the tentative state should be ignored and only the recorded\n state is relevant. When we start a transaction both states coincide by\n definition (we throw away any existing tentative state). When we end a\n transaction, we throw away the recorded state and overwrite it with the\n tentative one.\n \n Note that not all of Darcs.Repository has been changed yet to follow the\n transaction protocol yet, in particular the pending and unrevert states.\n This will be done in a later patch because the distinction between recorded\n and tentative state gets in the way of making the decision at runtime when\n reading the state. Also note that while this patch touches many lines of\n code, the changes are very systematic and mostly mechanical.\n] \n\n[fix rt ~ 'RO in AskAboutDeps\nBen Franksen <ben.franksen@online.de>**20210301152702\n Ignore-this: a7407c6f80e3eb5875536ce8fc7a670f138961589efc005811c178f402d9526417089761c838ca6c\n] \n\n[replace readTentativePristine with the generalized readPristine\nBen Franksen <ben.franksen@online.de>**20210227101454\n Ignore-this: d9d1cf61973e9ab95dc708b373f7aadd3e272ff4165eec573ab5e1f44c12581c87c093abd3dd3407\n \n The latter now now does the right thing for both RO and RW repos.\n] \n\n[convert D.R.Pristine to assign the correct access type parameters\nBen Franksen <ben.franksen@online.de>**20210227102318\n Ignore-this: 63c809826e1067304cb7ce41218b14618e17244bc9a3d96c321659b8a1426735f9ef9d791203d821\n \n The same schema as in D.R.Hashed applies: functions that modify the\n tentative pristine are only available for 'RW typed repos, those that only\n read pristine decide at runtime which files to read and stay polymorphic.\n \n A special (and ugly) case is replacePristine which has a case for 'RO typed\n repos, which should only be used when creating a fresh repo. The 'RW case\n now modifies the tentative pristine, so we need to add missing finalization\n in the repair and optimize pristine commands.\n] \n\n[convert size-prefixed pristine when we start a transaction\nBen Franksen <ben.franksen@online.de>**20210227084925\n Ignore-this: c65c10432771c40ca52a6ff0d8598d6495129c95c08e01725187bc3191670461c92244bf73c3a5c5\n \n We must not modify _darcs/hashed_inventory except when finalizing a\n transaction.\n] \n\n[writeTentativeInventory now takes a Repository argument\nBen Franksen <ben.franksen@online.de>**20210225212710\n Ignore-this: c90aad2cd771f5819bf7f488282a5562d1bc7ed41884f575d757670746c6f87b398db2ce30692e8\n] \n\n[lock/unlock inside revert/finalizeRepositoryChanges\nBen Franksen <ben.franksen@online.de>**20210225115451\n Ignore-this: a79c711ff6321244cce72b943864c639f49d362a296fbb5a34b7c805c6b88eb6e7469460e9354cf1\n \n This has the disadvantage that intermediate commits also unlock the\n repository for a short time. However, intermediate commits are mostly\n unnecessary, the only remaining instance is in convert darcs-2, which will\n soon become obsolete anyway.\n] \n\n[convert D.R.Hashed functions to take access typed Repository\nBen Franksen <ben.franksen@online.de>**20210225154559\n Ignore-this: ab05083221ceaa72f2558fbc88b0ca8e4027c5aaf985cfa085f6233ff9c9f6215a77eb1fd34490dc\n \n All procedures in D.R.Hashed that access the tentative state now take a\n Repository 'RW, while 'readPatches' stays polymorphic, but reads the\n tentative or the recorded state, depending on the Repository access type\n parameter. This required to export SAccessType from D.R.InternalTypes and\n return that type from repoAccessType, so that pattern matching on the result\n forces unification of the Repository's access type.\n] \n\n[re-type the rt type parameter to AccessType=RO|RW\nBen Franksen <ben.franksen@online.de>**20210224230403\n Ignore-this: 58799b29145cd3924411fd902ab7e49772d5950a77a159bfd6d31d6ef6370c8d92184cbf9a875455\n \n This patch does not yet go the full way of changing all Repository access\n procedures, only some of the central pieces: revertRepositoryChanges and\n finalizeRepositoryChanges, withRepoLock, repo creation and identification.\n Commands that call withRepoLock now take the lock even when --dry-run is in\n effect. This fixes a potential race condition because in dry-run mode these\n commands still modified the tentative state on disk. Instead, the dry-run\n option is now evaluated in the finalizing procedures (which includes,\n currently, addPendingDiffToPending and addToPending).\n] \n\n[remove rt::RepoType type parameter from PatchSet and PatchInfoAnd\nBen Franksen <ben.franksen@online.de>**20210224225716\n Ignore-this: 21347143ab31dc16399b2b1d7145f88d715d713d92a0f05c74cb6a32948c392a9aa7fe2ea2790a3a\n] \n\n[remove most of Darcs.Patch.RepoType\nBen Franksen <ben.franksen@online.de>**20210119150023\n Ignore-this: eee8e2332d551296501be870481b04f1d24ef7356ca9c7c91fe3a37c0d000b953b0d9064cefe2aad\n \n This removes the type distinction between repos with and without a rebase in\n progress. The 'rt :: RepoType' type parameter (and its kind RepoType) are\n kept for now, in case we ever want to re-introduce such a type distinction\n for some other purpose.\n] \n\n[extend environment help for DARCS_SCP\nBen Franksen <ben.franksen@online.de>**20220413113259\n Ignore-this: 1b66f7a941f16f79cd7f613c66992322fe865b17a9ee03f88f19f1a23d86783870351037a13cf603\n] \n\n[tests/network/ssh.sh: remove directories before creating them\nBen Franksen <ben.franksen@online.de>**20220413113337\n Ignore-this: 30e9ae6d401b741e421065322999639770676ef17add7e70439b292856d0a82cc71b59636a632ba\n] \n\n[clarify the tricky parts of clone to ssh\nBen Franksen <ben.franksen@online.de>**20220413111735\n Ignore-this: 5b8becac7737b7714aa26c2ad181449e7cc0edac2af7eb6948f68b0f22eae92c62401ec12d88d7c\n] \n\n[resolve issue189: external merge with renamed files\nBen Franksen <ben.franksen@online.de>**20220413073559\n Ignore-this: dbde5df518d72bd01132dcaaa514728ef8479bfd2b23fa01985bb3f6baebc64a102a953ab87c5a85\n \n Indeed, there was a glaring error in the externalResolution procedure.\n] \n\n[accept issue189: external merge with renamed files\nBen Franksen <ben.franksen@online.de>**20220413074904\n Ignore-this: 6f1679e176058f8f540fdc98afaa4cda60017f8c0f17e410806657ff2f8a6cf42950c28479b25010\n \n This patch depends on the one that causes darcs to fail if the external\n merge tool does, otherwise the test script cannot detect the problem.\n] \n\n[fix: preserve output (stderr, stdout) of an external merge tool\nBen Franksen <ben.franksen@online.de>**20220413074510\n Ignore-this: 79a33fcbdf40213e39bff872915baf4c51407cc10a8d69898a936c225672ca9dd835f0ab22545631\n \n This makes it easier to diagnose problems when using an external merge tool.\n] \n\n[fix: darcs should fail if an external merge tool does\nBen Franksen <ben.franksen@online.de>**20220413074232\n Ignore-this: e5b545d33deaed821bc725ede6f10e53fefa6109d00746fc599fba91d3e8f16386622c54c782690a\n \n This is necessary in order to detect problems and write proper test scripts.\n] \n\n[clone command: System.FilePath -> System.FilePath.Posix\nBen Franksen <ben.franksen@online.de>**20220411072722\n Ignore-this: df442365fcf19fff5a432d77268a94da9812fe7c71c8f6b8b3335baa87aa8798990ab475fd6a6fde\n] \n\n[extend test script for clone to ssh\nBen Franksen <ben.franksen@online.de>**20220410104859\n Ignore-this: a7d84502bab033afec06748ef1cc845af85c1dcadb62eabc1859a9dd5206ae518556c0e549949152\n] \n\n[fix: try create parent directories when cloning to a remote repository\nMaksim Golubev <maksim.golubev72@gmail.com>**20220321004943\n Ignore-this: 56890e4071151105b12634748d42c33d670c4ac4cf6edbd8068c5ae122af07c7d0ff522e865046e7\n \n When cloning to a remote repository, we are now trying to create the entire\n hierarchy of parent directories if they were missing.\n] \n\n[fix: cloning to an external repository led to the creation of an extra nested directory\nMaksim Golubev <maksim.golubev72@gmail.com>**20220321004246\n Ignore-this: ac7b76cacdaf1358d76e386c6e0056929ee7a2f65eb916018a430872265ce7945f5b02c05f685f19\n \n Before copying the data using the scp command, a remote directory corresponding\n to the new repository is created beforehand to check whether the contents of\n this directory will not be deleted if it already exists. But if you leave this\n directory, the scp command will create another directory inside it. Therefore,\n before executing scp, we will delete the created directory.\n] \n\n[support Cabal 3.6\nGanesh Sittampalam <ganesh@earth.li>**20220205214338\n Ignore-this: 69fa945b18f5b5143fc53456f26bcd9e\n] \n\n[ci: exclude macOS-10.15 && ghc-8.10.4\nBen Franksen <ben.franksen@online.de>**20210611183809\n Ignore-this: 315739f6a58998368cf6dd068d4da8e459374681914f08b0dffc21d923fdc08aef6f6da3d301d699\n] \n\n[cleanup code layout of Darcs.Util.Tree.expandUpdate\nBen Franksen <ben.franksen@online.de>**20210429083448\n Ignore-this: 1c2fc782fbbdb3d25cd7ba394c87a8a291626d69a2c1250f9970b280d223f3c4fbe2b5d4a208694c\n] \n\n[add comment to updateHashes in convert import command\nBen Franksen <ben.franksen@online.de>**20210421114628\n Ignore-this: 296fa556cd510a9a39204cbbbfe838d8e7c694f4118b413414c9e24997a63cbb0a12ff38022553ec\n] \n\n[remove an obsolete FIXME comment\nBen Franksen <ben.franksen@online.de>**20210418155917\n Ignore-this: d02fdab017f3223ae4e01efdea2223816f9656abd3ff9d474605c71faeaeef1d1a3f234e8209b88c\n] \n\n[factor out delaySealed\nBen Franksen <ben.franksen@online.de>**20210406121845\n Ignore-this: 5e4c7a5105d564f61001a823034e81451711a9614220300b83a4250cede65c3b021889f04e0baa0b\n] \n\n[add debug message in applyToWorking\nBen Franksen <ben.franksen@online.de>**20210314221902\n Ignore-this: 2f292e632a8e46c65b9797da6a91d24421d2f171d68f59c8c610d3bf9a615e4341528d11080eb1e0\n] \n\n[D.R.Traverse: cut down the list of exported symbols\nBen Franksen <ben.franksen@online.de>**20210303140603\n Ignore-this: 72471dcd6daa900dd833bb4227859730392861d84cd96cb482d485e1a42e32db8d648d9587a8a577\n] \n\n[rename withRepoLocation -> withRepoDir\nBen Franksen <ben.franksen@online.de>**20210228122604\n Ignore-this: 59f365cd4b78349051c71ee8f359d8f47e2009117284b2bbef11d9e16bad31c804d1c6e30a0fc70b\n] \n\n[replace class ApplyMonadState with a top-level type family\nBen Franksen <ben.franksen@online.de>**20210403052400\n Ignore-this: 44e612123ac4c648172b7faa858c454e06202979d4786b5b995af23320de86d1fa81ebfd4e06993b\n \n The class ApplyMonadState was only there to carry the type (constraint)\n family ApplyMonadStateOperations, which I renamed to ApplyMonadOperations\n for brevity.\n] \n\n[cleanup method definitions in D.P.ApplyMonad\nBen Franksen <ben.franksen@online.de>**20210315204754\n Ignore-this: 857d05e8ebefd55ce919d8f0a5e0ee04d52f414fbb67309b7cc95502e912e260dc7300424da4d87c\n \n This removes -fno-warn-missing-methods and explicitly defines missing\n methods as undefined. The default definition of mCreateFile in terms of\n mModifyFilePS is removed. Defining a proper mCreateFile means we can remove\n the existence check from the definition of mModifyFilePS in the instance\n ApplyMonadTree (TM.TreeMonad m).\n] \n\n[remove unused RestrictedApply from D.P.ApplyMonad\nBen Franksen <ben.franksen@online.de>**20210315204621\n Ignore-this: a6baf4368bd7a8894afb559badab38c2ecb6814ff4e4867efc1967815449c2f5fa0d79dcd1590e83\n] \n\n[remove duplicate import of darcsAddMissingHashes\nBen Franksen <ben.franksen@online.de>**20210329092310\n Ignore-this: 5768fb8482f22fcc01214bd6f1dd4f465620dff4c892bc3a782bbb431b63ca8cec303e0c213e6be5\n] \n\n[show index: print table headers\nBen Franksen <ben.franksen@online.de>**20210415095307\n Ignore-this: 18a6aa1d67b99042fcd7922a1759b1c1dc92e6c27da170da59a10eebc9ea1e68ee118098360966d7\n] \n\n[rename replacePristine to writePristine\nBen Franksen <ben.franksen@online.de>**20210227104011\n Ignore-this: 1e83843b748164d7d69358dd5e5c8d068e8556d0b5eb8a6b523d1202a531affebd3f48dee734a2a9\n] \n\n[inline writePristine into the slightly safer replacePristine\nBen Franksen <ben.franksen@online.de>**20210227065632\n Ignore-this: 67be252d4074427f4eda80cdd0b32d9f1df2f6a8a0d01cb765f2f33b126348d647ae8cefcf6c3306\n] \n\n[move writePristine and replacePristine to D.R.Pristine\nBen Franksen <ben.franksen@online.de>**20210226072752\n Ignore-this: 962840dcfe69dc9c7e75d9ff594feb7e8abe592019639c5b0a4c07972124d9ec96ffcbb370fc64dd\n] \n\n[inline D.R.Pristine.withRecorded\nBen Franksen <ben.franksen@online.de>**20210225201917\n Ignore-this: fd7096445bc1ad5649531dd7d7e84c56e2282e468c1a1c1fda73fe67093deb6b28568c2af07687f2\n] \n\n[fix the haddocks for applyToHashedPristine\nBen Franksen <ben.franksen@online.de>**20210306155542\n Ignore-this: a2b27a89532379fcfdb4475e7526e1240b62b4b8ec85825080d923fa9e438f449148e1a64c7ca17a\n] \n\n[make readPristine fail for old-fashioned repos\nBen Franksen <ben.franksen@online.de>**20201109213344\n Ignore-this: d557e21edc3aa84d8cb10d674b0dbbc6e1a6add0b2bf1e9d30affefc0986a5ea30f68435166819e2\n \n The extra code for the case of repos that aren't in hashed format is\n apparently not needed.\n] \n\n[streamline the code in the darcs main module\nBen Franksen <ben.franksen@online.de>**20210304074801\n Ignore-this: 7ae5d5397e77c6a2b29955a1ae88e9524c09e94e127ad2c7a847d3c1a0adb3d4e86ce3724b415d44\n] \n\n[cleanup Darcs.Util.AtExit\nBen Franksen <ben.franksen@online.de>**20210304073226\n Ignore-this: 728c2bda1267808f6064e2414a4d764954a5249ecc198b640585d7d5fc7595644c64d43683ac5ef3\n \n Apart from layout changes, this replaces bracket_ with finally and removes\n the extra mask/unmask stuff; the exit action of bracket/finally is executed\n in masked state anyway, so any further masking/unmasking has no effect.\n] \n\n[fix stale lock files after Ctrl-C\nBen Franksen <ben.franksen@online.de>**20210304064825\n Ignore-this: c362c176b5248c96fa9debb939c309266825ef2b513c2d1f539e8b7f53196cd24195ad9ffd269f40\n \n This changes the order of the handlers in the main function of the darcs\n executable, so that atexit is handled earlier than signals. This should also\n have the effect of removing temporary files and directories created using\n withDelayedDir in a more reliable manner.\n \n Both handleErrors and handleExecFail are uncritical, they merely re-classify\n and annotate certain exceptions and report them in a more user friendly\n fashion, so handleExitFail was also moved out of the withSignalsHandled.\n] \n\n[move command: readPlainTree -> readUnrecordedFiltered\nBen Franksen <ben.franksen@online.de>**20210122172254\n Ignore-this: 24506233de7ee3bdf560bbb72fab7621df4d586c53f910f709169346ea90c7f114d8c0c8ff1a9b90\n \n The difference is that readUnrecordedFiltered (with the given options) uses\n the index, if possible.\n] \n\n[remove lookFor* functions from Darcs.UI.Flags\nBen Franksen <ben.franksen@online.de>**20210605143653\n Ignore-this: 251a3321032281674e26ff2f43894286dd0ee0c1be6047a8eb9617e1f3534b2a1c6ec82fac44f9a4\n \n Two of them are unused (outside of the defining module) and they all collide\n with the members of DiffOpts.\n] \n\n[remove duplicate definition of diffingOpts\nBen Franksen <ben.franksen@online.de>**20210605143413\n Ignore-this: 9980cd2b1b010097fcaec12fe1b97bf322a864cf375ed16d000387a6190a7c4bea2e0094f18e3d8a\n] \n\n[add PatchHeaderConfig\nBen Franksen <ben.franksen@online.de>**20210303171700\n Ignore-this: 51df902f048fe1bdc32146e544ef368824677bd4a88cc4a942db0175450fa667bab2ddccfdf12c37\n \n This groups everything we get from the command options into a record type to\n cut down on the number of parameters of updatePatchHeader. Also add the\n patchname option to rebase unsuspend and re-order the options so they are\n the same as for amend.\n] \n\n[rebase unsuspend: add more patch editing options\nBen Franksen <ben.franksen@online.de>**20210302213552\n Ignore-this: 9173186fbc49dac677ded69fbddf52ff20b22d0c013207f3616fcb917cf915ba05864fe93965ae8\n \n These require no extra code, they are handled by updatePatchHeader.\n] \n\n[ci: run tests only for latest cabal and earliest & latest ghc version\nBen Franksen <ben.franksen@online.de>**20210607073645\n Ignore-this: 38f4353188f3d7b8ffeea1fd600781f171e6bbfa6a84b259689a8080db371d75c12bb542eddb3d0b\n] \n\n[use path definitions from D.R.Paths in a few more places\nBen Franksen <ben.franksen@online.de>**20210227061118\n Ignore-this: 203551b945fc2af5c4eef5a6a6ac5de0f582e919bbfda840bae8b989dc993abb28e17fcdc8404d16\n] \n\n[remove some outdated or otherwise unfortunate comments\nBen Franksen <ben.franksen@online.de>**20210305061108\n Ignore-this: 1196b6fc176f6676db204d6ee9698cf342a7994a8d1804a777e3117a0b76015fefbb4e5a4df81184\n \n The \"otherwise unfortunate\" refers to mentions of repository file paths;\n these will become outdated if we make changes to them.\n] \n\n[use paths from D.R.Paths in D.R.Packs\nBen Franksen <ben.franksen@online.de>**20201108125712\n Ignore-this: 749668dc014f43ac07a19da7465a199285a4481f5ac8daa289e576a30c1399c938e76d3e1eb4cdc3\n \n This also removes an obsolete debugMessage and then inlines\n fetchFilesUsingCache.\n] \n\n[tests/network/show_tags-remote.sh: remove directories\nBen Franksen <ben.franksen@online.de>**20210529153906\n Ignore-this: 4cb6240ee582a069e97478e207041769cbfa27c7674d1ecfa4630926a1cfae43977824a7bd6b58f\n] \n\n[tests for issue1327 and issue2047 fail only for darcs-1 and darcs-2\nBen Franksen <ben.franksen@online.de>**20210527165230\n Ignore-this: aa267cc3017b9d1eea875ff61adfbf9aa4920cdc1cdd5a8f0dc8bb7e6c5f000b1b927bb6c1edf488\n] \n\n[test for issue1579 no longer fails\nBen Franksen <ben.franksen@online.de>**20210527164014\n Ignore-this: 64bba9cb049c4ba78c7977145efbb5ac1f11e1522f4e19e6a1486ffbe18fb5e58da0c72a3f114cfa\n] \n\n[tests: mark issue1014 as no longer failing\nBen Franksen <ben.franksen@online.de>**20210527161920\n Ignore-this: 47d001eef87c89766407280be02af23afa1c6cb357dbf8c5d4ad97c182ee89231b7650167c69d0d5\n \n After fixing a few minor issues in the test script, this test succeeds for\n darcs-3 as that fixes the underlying issue. However, the test script needed\n a few minor fixes to actually fail for the right reason. In particular,\n cloning a conflicted repo nowadays applies conflict markup, which we have to\n revert before pulling, otherwise we get prompted and the test fails with\n \"promptChar: unexpected end of input\".\n] \n\n[harness: run test-framework with explicit RunnerOptions\nBen Franksen <ben.franksen@online.de>**20210303110226\n Ignore-this: 11651f3e41ad325e9608b2c367a866012616f6a58187b2425008932d87188daec3f3ffdfd4a50a17\n] \n\n[remove overspecification of pending from tests\nBen Franksen <ben.franksen@online.de>**20210324072532\n Ignore-this: 3ce02680e19fd8e30aad4ecc0fb69585cce303e3cbb780c5d9a83f81b2b7bccecc086b0bbce92c5e\n \n The test scripts should not prescribe the concrete format of the pending\n patch, not even an empty one.\n] \n\n[obliterate, rebase suspend: pass NoUpdatePending to tentativelyRemovePatches\nBen Franksen <ben.franksen@online.de>**20210302131340\n Ignore-this: 4f35536d5091c3c9cb671a380fa72156330b46cf9ea6ef7bb767b29e182c783af047c9e8cb5b3609\n \n This avoids the redundant use of the (unsafe) tentativelyAddToPending to\n remove what gets added to pending with YesUpdatePending.\n] \n\n[remove UpdatePending parameter to withRepoLock\nBen Franksen <ben.franksen@online.de>**20210122173346\n Ignore-this: c3bde2b310554f26a98d38f6cf97a0c75988b45429a4d16c53f694feb7b62e2c550f71d03a0b5280\n \n It turned out that we always call that procedure with YesUpdatePending, so\n we can as well hard-code it.\n] \n\n[simplify readPatchesUsingSpecificInventory\nBen Franksen <ben.franksen@online.de>**20201223204234\n Ignore-this: a73c7d343c1310e1aacb5d52c439efd3b9a97f7409a670b0e099fb532c60c74d6eececf8abdaf11b\n] \n\n[move revert/finalize of rebase from D.R.Hashed to D.R.Rebase\nBen Franksen <ben.franksen@online.de>**20210224124453\n Ignore-this: 84d15717486d2bc4ea795d024515aa2a339476c2f0cc9943024d761e588d871bde505ad1171ed60a\n] \n\n[in fetchFileLazyPS also check for URI scheme \"https:\"\nBen Franksen <ben.franksen@online.de>**20210525125416\n Ignore-this: 5606ea6f55be3edca3a7ee4507947095352692bd00b61fa15a7a4fb10b8031dd3b91fe430f9d9521\n] \n\n[Darcs.Util.SignalHandler: replace throw with throwIO\nBen Franksen <ben.franksen@online.de>**20210602203613\n Ignore-this: 933bfdeb1e297e6a62beadd3362607aa7cbae9562cd169cfb85e95a0088d5a9c1001f9e90c1ae716\n] \n\n[Darcs.Util.ByteString: avoid throwing exceptions from pure code\nBen Franksen <ben.franksen@online.de>**20210602203401\n Ignore-this: e6dbe87e1dace4fbe3aa386dd9fbb8d097576f460fda5ce5eb60781a8276a2e22f89b8530b4bd8b1\n] \n\n[D.R.Hashed: make debug messages less verbose\nBen Franksen <ben.franksen@online.de>**20210529152703\n Ignore-this: 181e110cf105cb1e25c525420522394bdff0cd604befa27ee4818c335f08139a974096c9a8d66416\n \n The patch name should be sufficient to see which patch is being read.\n] \n\n[Windows build fix in Darcs.UI.External\nGanesh Sittampalam <ganesh@earth.li>**20210603170522\n Ignore-this: 48da742c87f9e281dd7bb4adb95cf7ca3dd0c7f2b5ed301c72703e8699186f8f5a713d8a98695e64\n] \n\n[TAG 2.17.1\nBen Franksen <ben.franksen@online.de>**20210603145935\n Ignore-this: 78fb3abbe5aaee753f99906467c1fafcd15573995d5878e6d8613762190276de8dfed8cbbcbc0c68\n] \n"